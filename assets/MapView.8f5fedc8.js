import{_ as u,o as n,c as i,a as _,t as d,b as h,d as r,r as g,e as m,n as y,F as b,f as v,p as w,g as I}from"./index.10b3fb56.js";const M={},R={class:"spinner-border text-primary mt-5 mx-auto d-block",role:"status"};function L(e,t){return n(),i("div",R)}var S=u(M,[["render",L],["__scopeId","data-v-a402fe06"]]);const x={props:{message:{required:!0},showRetryBtn:{type:Boolean,required:!1,default:!0}}},E={class:"alert alert-danger"},P=r("br",null,null,-1);function A(e,t,a,l,s,c){return n(),i("div",E,[_(d(a.message)+" ",1),P,a.showRetryBtn?(n(),i("button",{key:0,class:"btn btn-primary me-2",onClick:t[0]||(t[0]=p=>{e.$emit("retryBtnClick")})},"R\xE9ssayer")):h("",!0),r("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=p=>e.$router.back())},"Retourner en arri\xE8re")])}var C=u(x,[["render",A]]);const O={data(){return{mapUid:String(this.$route.params.uid),fetchOpts:{},CORS_PROXY_API:"https://api.allorigins.win/raw?url=",MAP_INFO_API:"https://trackmania.io/api/map/",LEADERBOARD_API:"https://trackmania.io/api/leaderboard/map/",mapInfo:{},leaderboards:[],isDarkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,fetchLoading:!1,loadMoreLoading:!1,fetchErrorState:!1,fetchErrorMessage:""}},mounted(){this.fetchDatas(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.isDarkMode=e.matches})},methods:{async fetchDatas(){if(!window.fetch){this.fetchErrorState=!0,this.fetchErrorMessage="Votre navigateur ne supporte pas la m\xE9thode Fetch. Veuillez mettre \xE0 jour votre navigateur.";return}this.fetchLoading=!0;try{this.mapInfo=await this.getMapInfo(),this.leaderboards=await this.getLeaderboard(),window.document.title=this.formatString(this.mapInfo.name.replace(/ -[# A-Za-z0-9]*$/gi,""))+" - Uig.li"}catch(e){this.fetchErrorState=!0,this.fetchErrorMessage=`Erreur lors de la r\xE9cup\xE9ration des donn\xE9es. Veuillez r\xE9essayer ult\xE9rieurement.
Details: `+e}this.fetchLoading=!1},async getMapInfo(){let e=await fetch(this.CORS_PROXY_API+encodeURIComponent(this.MAP_INFO_API+this.mapUid),this.fetchOpts);if(!e.ok)throw e.statusText;return await e.json()},async getLeaderboard(){let e=new URLSearchParams;e.append("offset",this.leaderboards.length),e.append("length",100);let t=await fetch(this.CORS_PROXY_API+encodeURIComponent(this.LEADERBOARD_API+this.mapUid+"?"+e.toString()),this.fetchOpts);if(!t.ok)throw t.statusText;return(await t.json()).tops},async loadMoreLeaderboard(){this.loadMoreLoading=!0;let e=new URLSearchParams;e.append("offset",this.leaderboards.length),e.append("length",100);let t=await fetch(this.CORS_PROXY_API+encodeURIComponent(this.LEADERBOARD_API+this.mapUid+"?"+e.toString()),this.fetchOpts);if(!t.ok)throw t.statusText;let a=await t.json();this.leaderboards=this.leaderboards.concat(a.tops),this.loadMoreLoading=!1},convertMsToTime(e){let t=e%1e3,a=Math.floor(e/1e3)%60,l=Math.floor(e/6e4);return t<10?t="00"+t:t<100&&(t="0"+t),a<10&&(a="0"+a),l+":"+a+"."+t},formatString(e){let t,a;for(a=e.replace(/\$T/g,"$t").replace(/\$Z/g,"$z");(t=a.match(/\$t(.)*(\$z)|\$t(.)*$/g))!==null;)for(let l=0;l<t.length;l++)a=a.replace(t[l],t[l].toUpperCase());return a=a.replace(/\$\$/gi,"$"),a.replace(/\$[<>wnoisgtz]|\$[hl]\[(.)+\]|\$[hl]|\$[0-9a-fA-F]{3}/gi,"")}},components:{LoadingProgress:S,ErrorBox:C}},f=e=>(w("data-v-6b199674"),e=e(),I(),e),B={key:2,class:"mt-4"},T={key:0},D={class:"row"},$={class:"col-sm-4 gap-3"},U=["src","alt"],V={class:"d-grid mt-3"},z=["href"],j=f(()=>r("i",{class:"fa fa-heartbeat","aria-hidden":"true"},null,-1)),F=_(" Voir sur Trackmania.io "),N=[j,F],X=["href"],Y=f(()=>r("img",{src:"https://trackmania.io/img/tmx.png",alt:"Voir sur TMX",width:"20"},null,-1)),Z=_(" Voir sur Trackmania.exchange "),q=[Y,Z],J={class:"col-sm-8"},G=f(()=>r("thead",null,[r("tr",null,[r("th",null,"Rang"),r("th",null,"Joueur"),r("th",null,"Temps")])],-1)),H=["href"],K={class:"text-danger"},Q={key:0,class:"d-grid"};function W(e,t,a,l,s,c){const p=g("LoadingProgress"),k=g("ErrorBox");return n(),i(b,null,[s.fetchLoading?(n(),m(p,{key:0})):h("",!0),s.fetchErrorState?(n(),m(k,{key:1,message:s.fetchErrorMessage,onRetryBtnClick:c.fetchDatas},null,8,["message","onRetryBtnClick"])):h("",!0),!s.fetchLoading&&!s.fetchErrorState?(n(),i("div",B,[s.mapInfo.name?(n(),i("h1",T,d(c.formatString(s.mapInfo.name.replace(/ -[# A-Za-z0-9]*$/gi,""))),1)):h("",!0),r("div",D,[r("div",$,[r("img",{class:"img-fluid mapThumb",src:s.mapInfo.thumbnailUrl,alt:s.mapInfo.name},null,8,U),r("div",V,[r("a",{href:"https://trackmania.io/#/leaderboard/"+s.mapUid,target:"_blank",class:"btn btn-primary"},N,8,z),s.mapInfo.exchangeid!=0?(n(),i("a",{key:0,href:"https://trackmania.exchange/tracks/view/"+s.mapInfo.exchangeid,target:"_blank",class:"btn btn-primary mt-3"},q,8,X)):h("",!0)])]),r("div",J,[r("table",{class:y(["table table-hover",this.isDarkMode?"table-dark":""])},[G,r("tbody",null,[(n(!0),i(b,null,v(s.leaderboards,o=>(n(),i("tr",{key:o.position},[r("td",null,d(o.position==1?"\u{1F947}":o.position==2?"\u{1F948}":o.position==3?"\u{1F949}":o.position),1),r("td",null,[_(d(o.player.tag?`[${c.formatString(o.player.tag)}] `:"")+" ",1),r("a",{href:"https://trackmania.io/#/player/"+o.player.id,target:"_blank"},d(o.player.name),9,H)]),r("td",null,[_(d(c.convertMsToTime(o.time))+" ",1),r("span",K,d(o.position>1?" (+"+c.convertMsToTime(o.time-s.leaderboards[o.position-2].time)+")":""),1)])]))),128))])],2),s.loadMoreLoading?(n(),m(p,{key:1})):(n(),i("div",Q,[r("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...o)=>c.loadMoreLeaderboard&&c.loadMoreLeaderboard(...o))},"Chargez plus...")]))])])])):h("",!0)],64)}var te=u(O,[["render",W],["__scopeId","data-v-6b199674"]]);export{te as default};
